<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookCrossing - Browse Books</title>
    <link rel="website icon" type="png" href="Assets/logo icon.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @font-face {
            font-family: Alex-brush;
            src: url(Alex_Brush/AlexBrush-Regular.ttf);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fff;
            color: #333;
        }

        /* Navbar */
        .navbar {
            background-color: #f8f9fa;
        }

        .navbar-brand img {
            height: 35px;
            margin-right: 10px;
        }

        .nav-link {
            color: black !important;
            font-weight: 500;
            margin: 0 10px;
            font-weight: 300;
        }

        .nav-link:hover {
            color: #f8ca30 !important;
            font-weight: 500;
            margin: 0 10px;
            text-decoration: underline;
        }

        /* Styling banner */
        #banner-container {
            background-image: url(Assets/browser\ banner.PNG);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .main-heading1 {
            font-family: Alex-brush;
        }

        .sub-heading1 {
            font-family: 'Times New Roman', Times, serif;
        }

        /* Available Heading */
        .category-title {
            text-align: center;
            font-size: 2rem;
            font-weight: 600;
            margin-top: 60px;
            margin-bottom: 20px;
            font-family: 'Playfair Display', serif;
        }

        /* Book Cards */
        /* Book Card Styles */
        .book-title {
            font-weight: 600;
            font-size: 1rem;
            margin-top: 8px;
            margin-bottom: 5px;
            color: #333;
        }

        .book-author {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 8px;
        }

        .borrow-btn {
            background-color: white;
            color: #c8c5c5;
            border: none;
            padding: 2px 5px 2px 5px;
            margin-top: 20px;
            border-radius: 20px 0px 20px 0px;
            border: 2px solid #f8ca30;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .borrow-btn:hover {
            background-color: #f8ca30;
            color: #000;
        }

        .book-card {
            background: #fff;
            border: 3px solid #ececec;
            text-align: center;
            padding-bottom: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .book-card:hover {
            transform: translateY(-5px);
        }

        .book-card img {
            height: 280px;
            object-fit: cover;
            width: 100%;
        }

        .book-info {
            padding: 15px;
            text-align: center;
        }

        .book-info{
            padding: 10px 5px;
            text-align: center;
        }
        .book-info h6 {
            font-weight: 600;
            font-size: 15px;
            margin-top: 8px;
            margin-bottom: 5px;
        }

        .book-info p {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 8px;
        }

        .book-info .btn {
            background-color: white;
            color: #c8c5c5;
            border: none;
            padding: 2px 5px 2px 5px;
            margin-top: 10px;
            border-radius: 20px 0px 20px 0px;
            border: 2px solid #f8ca30;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .book-info .btn:hover {
            background-color: white;
        }

        .rating {
            color: #f1c40f;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        /* Search Section */
        .search-section {
            background-color: #f8f9fa;
            padding: 40px 0;
            margin-bottom: 40px;
        }

        .search-box {
            max-width: 600px;
            margin: 0 auto;
        }

        /* Styling footer */
        footer {
            background-color: #f5f2f2;
            padding: 40px 0 10px;
            font-size: 14px;
            color: #000;
        }

        .footer-logo img {
            width: 150px;
            height: 40px;
            margin-right: 8px;

        }

        .footer-quote {
            font-size: 14px;
            line-height: 1.4;
            margin-top: 10px;
        }

        .footer-title {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .footer-links a {
            display: block;
            color: #000;
            text-decoration: none;
            margin-bottom: 6px;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .footer-bottom {
            border-top: 2px solid #f1c40f;
            padding-top: 8px;
            margin-top: 20px;
            font-size: 13px;
        }

        /* Fix for footer social icons */
        footer .social-icons {
            text-align: right;
        }

        footer .social-icons img {
            width: 30px;
            height: 30px;
            margin-left: 10px;
            cursor: pointer;
            border-radius: 50%;
        }

        /* Book details  */
        .book-condition {
            font-size: 0.9em;
        }

        .owner-info {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
    </style>
</head>

<body>

    <!-- Navbar-->
    <nav class="navbar navbar-expand-lg px-4">
        <a class="navbar-brand d-flex align-items-center" href="index.html">
            <img src="Assets/main logo.png" alt="main-logo" id="main-logo" style="width:150px; margin-right:100px;">

        </a>
        <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mx-3">
                <li class="nav-item"><a href="#" class="nav-link">Browse Book</a></li>
                <li class="nav-item"><a href="About-us.html" class="nav-link">About Us</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Contact</a></li>
                <li class="nav-item"><a href="login.html" class="nav-link">Log In</a></li>
                <li class="nav-item"><a href="#" class="nav-link">Register / Sign Up</a></li>
            </ul>
        </div>
        <div class="d-flex">
            <a href="add-book.html" class="btn btn-warning">
                <i class="fas fa-plus me-1"></i> Add Book
            </a>
        </div>
    </nav>

    <!-- Making hero banner -->
    <div class="container-fluid" id="banner-container">
        <div class="row justify-content-between align-items-center" style="margin-right: 50px; margin-left: 50px;">
            <!-- Left Side Content -->
            <div class="col-lg-6 col-md-8 col-12 text-center text-lg-start">
                <div class="text-content overflow">
                    <h2 class="main-heading1">Biggest <span style="color:#f8ca30">Community</span> in the <span
                            style="color:#f8ca30">World</span>! </h2>
                    <h2 class="sub-heading1">Connecting readers across continents</h2>
                    <h2 class="sub-heading1">-Where every books finds a home.</h2>
                </div>
                <div class="image d-flex justify-content-center justify-content-lg-start">
                </div>
            </div>

            <!-- Right Side - Images (Moved Up on Large Screens) -->
            <div class="col-lg-5 col-md-6 col-12 d-flex justify-content-center align-self-start mt-n5 move-up"
                id="design">
                <div class="Square">
                    <div class="images overflow">
                        <img src="Assets/browser-book-img.png" alt="browser-book-img" class="img-fluid" />
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Search Section from Code 2 -->
    <section class="search-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="input-group search-box">
                        <input type="text" id="searchInput" class="form-control"
                            placeholder="Search by title, author, or genre...">
                        <button class="btn btn-warning" onclick="searchBooks()">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Books Grid-->
    <div class="container">
        <h3 class="category-title">Available Books</h3>
        <div class="row" id="booksGrid">
            <div class="col-12 text-center">
                <div class="spinner-border text-warning" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading books...</p>
            </div>
        </div>
    </div>

    <!-- Making Footer section -->
    <footer>
        <div class="container">
            <div class="row">
                <!-- Logo & Quote -->
                <div class="col-md-3">
                    <div class="d-flex align-items-center footer-logo">
                        <img src="Assets/main logo.png" alt="Logo" class="footer-logo">

                    </div>
                    <div class="footer-quote">
                        "Thank you for being a part of our story-sharing family—<br>
                        every book you share brings knowledge, kindness, and connection to someone new."
                    </div>
                </div>

                <!-- Services -->
                <div class="col-md-2 footer-links">
                    <div class="footer-title">User Action</div>
                    <p><span class="footer-user-actions">Register / Login</span><br>
                        <span class="footer-user-actions">Add a Book</span><br>
                        <span class="footer-user-actions">Search Books</span><br>
                        <span class="footer-user-actions">My Profile</span><br>
                        <span class="footer-user-actions">Messages</span>
                    </p>
                </div>

                <!-- About -->
                <div class="col-md-2 footer-links">
                    <div class="footer-title">About</div>
                    <a href="About-us.html" style="color: #000; text-decoration: none;"
                        onmouseover="this.style.color='#f1c40f';" onmouseout="this.style.color='#000';">About Us</a>
                </div>

                <!-- Policies -->
                <div class="col-md-2 footer-links">
                    <div class="footer-title">Policies</div>
                    <a href="terms-and-conditions.html" style="color: #000; text-decoration: none;"
                        onmouseover="this.style.color='#f1c40f';" onmouseout="this.style.color='#000';">Terms &
                        Conditions</a>
                </div>

                <!-- Get in Touch -->
                <div class="col-md-3 footer-links">
                    <div class="footer-title">Got In Touch</div>
                    <a href="mailto:bookcrossing@gmail.com" style="color: #000; text-decoration: none;"
                        onmouseover="this.style.color='#f1c40f';"
                        onmouseout="this.style.color='#000';">bookcrossing@gmail.com</a>
                    <a href="#" style="color: #000; text-decoration: none;" onmouseover="this.style.color='#f1c40f';"
                        onmouseout="this.style.color='#000';">Bookcrossing.com</a>
                    <a href="tel:+923412875468" style="color: #000; text-decoration: none;"
                        onmouseover="this.style.color='#f1c40f';" onmouseout="this.style.color='#000';">+92
                        3412875468</a>
                </div>
            </div>

            <!-- Bottom -->
            <div class="row footer-bottom">
                <div class="col-md-6">
                    © 2025 BookCrossing, Inc. All rights reserved.
                </div>
                <div class="col-md-6 text-end social-icons">
                    <img src="Assets/facebook logo.png" alt="fb">
                    <img src="Assets/tik tok logo.png" alt="tiktok">
                    <img src="Assets/insta logo.png" alt="insta">
                </div>
            </div>
        </div>
    </footer>


    <script>
        // Load all books when page loads
        document.addEventListener('DOMContentLoaded', function () {
            loadAllBooks();
        });

        // Browse books page pe SARI AVAILABLE BOOKS load karen
async function loadAllBooks() {
    try {
        console.log("Fetching ALL books from API...");

        // ✅ BINA user_id KE CALL KAREN - SARI BOOKS KE LIYE
        const response = await fetch('http://localhost/project/backend/api/books/read.php');
        console.log("Response status:", response.status);

        const data = await response.json();
        console.log("All books API Response:", data);

        if (data.books && Array.isArray(data.books)) {
            displayBooks(data.books);
        } else {
            console.log("No books array found in response");
            displayBooks([]);
        }

    } catch (error) {
        console.error('Error loading books:', error);
        document.getElementById('booksGrid').innerHTML = `
        <div class="col-12 text-center">
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Error loading books: ${error.message}
            </div>
        </div>
    `;
    }
}
        // Search books
        async function searchBooks() {
            const searchTerm = document.getElementById('searchInput').value.trim();

            if (searchTerm === '') {
                loadAllBooks();
                return;
            }

            try {
                // CORRECTED API URL
                const response = await fetch(`http://localhost/project/backend/api/books/search.php?q=${encodeURIComponent(searchTerm)}`);
                const data = await response.json();

                displayBooks(data.books || []);
            } catch (error) {
                console.error('Error searching books:', error);
            }
        }

        // DISPLAY BOOKS WITH ACTUAL IMAGES
        function displayBooks(books) {
            const booksGrid = document.getElementById('booksGrid');

            if (books.length === 0) {
                booksGrid.innerHTML = `
            <div class="col-12 text-center">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    No books found. Be the first to add a book!
                </div>
            </div>
        `;
                return;
            }

            console.log("📚 Displaying books with HOVER EFFECTS...");

            let html = '';
            books.forEach(book => {
                const randomRating = Math.floor(Math.random() * 2) + 3;
                const stars = '⭐'.repeat(randomRating);

                // ✅ ACTUAL BOOK IMAGES FROM DATABASE
                const mainImage = book.image_path || 'Assets/default-book.jpg';
                const secondImage = book.image_path2 || book.image_path || 'Assets/default-book.jpg';
                const thirdImage = book.image_path3 || book.image_path || 'Assets/default-book.jpg';

                console.log(`📖 ${book.title} Images:`, {
                    main: book.image_path || 'No image',
                    second: book.image_path2 || 'No image',
                    third: book.image_path3 || 'No image'
                });

                // ✅ HOVER EFFECTS WALA CARD (Aapke Atomic Habits card jaise)
                html += `
            <div class="col-lg-2 col-md-4 col-sm-6 mb-4">
                <div class="book-card" style="height: 375px;">
                    <img src="${mainImage}" 
                         id="bookImage_${book.id}"
                         onmouseover="swapPic('bookImage_${book.id}', '${secondImage}')"
                         onmouseout="swapPic('bookImage_${book.id}', '${thirdImage}')"
                         alt="${book.title}"
                         style="height: 180px; object-fit: cover; width: 100%; cursor: pointer;"
                         onclick="cycleBookImage('bookImage_${book.id}', '${mainImage}', '${secondImage}', '${thirdImage}')">
                   
                         <div class="book-info">
                        <h6 class="book-title">${book.title}</h6>
                        <p class="book-author">By ${book.author}</p>
                        <div class="rating">${stars}</div>
                        
                        <button class="btn btn-sm mt-2 borrow-btn" onclick="viewBookDetails(${book.id})">
                            <i class="fas fa-eye me-1"></i> View Details
                        </button>
                    </div>
                </div>
            </div>
        `;
            });

            booksGrid.innerHTML = html;
        }

        // ✅ HOVER EFFECT FUNCTION (Aapke swapPic jaise)
        function swapPic(elementId, newImage) {
            const element = document.getElementById(elementId);
            if (element && newImage) {
                element.src = newImage;
            }
        }

        // ✅ CLICK EFFECT FUNCTION - 3 Images Cycle Karega
        function cycleBookImage(elementId, mainImage, secondImage, thirdImage) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const currentSrc = element.src;
            const images = [mainImage, secondImage, thirdImage];

            // Find current image index
            let currentIndex = 0;
            for (let i = 0; i < images.length; i++) {
                if (currentSrc.includes(images[i])) {
                    currentIndex = i;
                    break;
                }
            }

            // Next image show karein
            const nextIndex = (currentIndex + 1) % images.length;
            element.src = images[nextIndex];

            // Reset hover effects for new image
            element.onmouseover = function () {
                const hoverIndex = (nextIndex + 1) % images.length;
                this.src = images[hoverIndex];
            };

            element.onmouseout = function () {
                this.src = images[nextIndex];
            };
        }

        // ✅ SIMPLE ERROR HANDLING
        function handleImageError(imgElement, bookId) {
            console.log(`❌ Image failed to load for book ${bookId}`);

            // Simple colored placeholder
            const colors = ['#4A90E2', '#3498db', '#2ecc71', '#e74c3c', '#f39c12'];
            const color = colors[bookId % colors.length];

            imgElement.src = `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="280" viewBox="0 0 200 280"><rect width="200" height="280" fill="${color}"/><text x="100" y="140" text-anchor="middle" fill="white" font-family="Arial" font-size="16">Book Cover</text></svg>`;

            // Remove hover effects
            imgElement.onmouseover = null;
            imgElement.onmouseout = null;
        }

        // IMPROVED ERROR HANDLING FOR BASE64
        // HANDLE CUSTOM IMAGE UPLOAD - SIMPLE VERSION
        function handleCustomImage(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (selectedImages.length >= 3) {
                alert('Maximum 3 images allowed');
                return;
            }

            //  TEMPORARY PREVIEW KE LIYE BASE64
            const reader = new FileReader();
            reader.onload = function (e) {
                const previewDataUrl = e.target.result;

                // Preview mein dikhane ke liye
                selectedImages.push(previewDataUrl);

                // Actual file store karein upload ke liye
                customImages.push({
                    file: file,
                    previewData: previewDataUrl
                });

                console.log("Custom image added for upload:", file.name);
                updateSelectedImagesPreview();
            };

            reader.readAsDataURL(file);
            event.target.value = ''; // Reset file input
        }

        function cycleImages(elementId, images) {
            const element = document.getElementById(elementId);
            if (element && images.length > 1) {
                const currentSrc = element.src;
                const currentIndex = images.findIndex(img => currentSrc.includes(img));
                const nextIndex = currentIndex === -1 ? 0 : (currentIndex + 1) % images.length;

                // Only cycle if not SVG placeholder
                if (!images[nextIndex].includes('data:image/svg')) {
                    element.src = images[nextIndex];
                }
            }
        }

        // VIEW BOOK DETAILS FUNCTION
       // VIEW BOOK DETAILS FUNCTION - UPDATED
function viewBookDetails(bookId) {
    console.log('Opening book details for ID:', bookId);
    // Redirect to book details page with book ID
    window.location.href = `book-details.html?id=${bookId}`;
}

        //  SEARCH ON ENTER KEY PRESS
        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                searchBooks();
            }
        });

        //  CREATE DEFAULT BOOK COVER IF NOT EXISTS
        function createDefaultBookCover() {
            // Ensure default book cover exists
            const defaultCover = 'Assets/default-book-cover.jpg';
            // Agar nahi hai toh colored SVG use karega automatically
        }


        // ✅ SEND BOOK REQUEST FUNCTION
function sendBookRequest(bookId, requestType) {
    if (!userData || !userData.user_id) {
        alert('Please login to send request');
        window.location.href = 'login.html';
        return;
    }

    const message = prompt(`Enter message for ${requestType} request:`);
    if (message === null) return; // User cancelled

    const requestData = {
        book_id: bookId,
        user_id: userData.user_id,
        request_type: requestType,
        message: message,
        proposed_return_date: requestType === 'Borrow' ? 
            new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] : null
    };

    fetch('http://localhost/project/backend/api/requests/create.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(requestData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Request sent successfully!');
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error sending request:', error);
        alert('Error sending request');
    });
}
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>